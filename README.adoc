= OpenShift Installation
Álvaro López Medina <alopezme@redhat.com>
v1.0, 2023-09
// Metadata
:description: This repository explores the different ways to install Openshift
:keywords: openshift, red hat, baremetal, installation
// Create TOC wherever needed
:toc: macro
:sectanchors:
:sectnumlevels: 2
:sectnums: 
:source-highlighter: pygments
:imagesdir: docs/images
// Start: Enable admonition icons
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
// Icons for GitHub
:yes: :heavy_check_mark:
:no: :x:
endif::[]
ifndef::env-github[]
:icons: font
// Icons not for GitHub
:yes: icon:check[]
:no: icon:times[]
endif::[]
// End: Enable admonition icons


This repository explores the different ways to install Openshift.

// Create the Table of contents here
toc::[]

== Introduction


In this repository, I will focus on the Agent-based installation. This is a subcommand of the OpenShift Container Platform installer. It generates a bootable ISO image containing all of the information required to deploy an OpenShift Container Platform cluster, with an available release image.

== Create the Vms


=== Using Kcli

.Useful kcli commands
[source, bash]
----
kcli create plan -f kcli-plan-acm.yaml acm # Create the OCP plan with name acm
kcli start plan acm
kcli stop plan acm
kcli get vm
kcli delete plan acm
----


=== Using vSphere

.Openshift Console
image::vsphere-vm-details.png[]

NOTE: Then, you can edit the name of the VM after installation to `sno-node`.


== Generate the ISO Image


.Generate files from the template
[source, bash]
----
source ./ocp-sno/env-vars && cat ./ocp-sno/install-config-template.yaml | envsubst > ./agent/install-config.yaml

source ./ocp-sno/env-vars && cat ./ocp-sno/agent-config-template.yaml | envsubst > ./agent/agent-config.yaml

----

NOTE: Remember that the NMState has to be installed in the node you launch the iso generation: `sudo dnf install nmstate`.

.Generate ISO image
[source, bash]
----
openshift-install --dir ./agent agent create image
----



== Upload ISO image to VMWare

We use the https://github.com/vmware/govmomi/tree/main/govc[govc] CLI.

.Using govc
[source, bash]
----
source ocp-sno/env-vars
# List all VMs
govc ls -l=true $(govc ls /SDDC-Datacenter/vm/Workloads)

# Get VM info
govc vm.info sno-node
----

.Upload ISO image
[source, bash]
----
govc datastore.upload --dc=SDDC-Datacenter --ds=WorkloadDatastore  agent.x86_64.iso agent2/alvaro-agent.x86_64.iso
----


== Begin the installation


.Upload ISO image
[source, bash]
----
openshift-install --dir ./agent agent wait-for bootstrap-complete --log-level=debug

openshift-install --dir ./agent agent wait-for install-complete --log-level=debug
----

